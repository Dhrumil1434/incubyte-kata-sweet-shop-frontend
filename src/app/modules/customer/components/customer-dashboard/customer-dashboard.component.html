<div class="customer-dashboard">
  <!-- Backend Test Section (Temporary) -->
  <section class="backend-test-section">
    <app-backend-test></app-backend-test>
  </section>

  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-left">
      <h1 class="dashboard-title">
        <i class="pi pi-heart text-primary"></i>
        Kata Sweet Shop
      </h1>
    </div>

    <div class="header-right">
      <div class="nav-buttons">
        <p-button
          label="Shop"
          icon="pi pi-box"
          severity="primary"
          [text]="true"
          [routerLink]="['/customer/shop']"
          class="nav-btn"
        >
        </p-button>
        <p-button
          label="My Purchases"
          icon="pi pi-shopping-bag"
          severity="secondary"
          [text]="true"
          [routerLink]="['/customer/purchases']"
          class="nav-btn"
        >
        </p-button>
        <p-button
          label="Profile"
          icon="pi pi-user"
          severity="help"
          [text]="true"
          [routerLink]="['/customer/profile']"
          class="nav-btn"
        >
        </p-button>
      </div>
      <div class="user-info">
        <i class="pi pi-user text-lg"></i>
        <span class="user-name">{{ currentUser?.userName || 'Customer' }}</span>
      </div>
      <p-button
        label="Logout"
        icon="pi pi-sign-out"
        severity="secondary"
        [text]="true"
        (onClick)="onLogout()"
        class="logout-btn"
      >
      </p-button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Search Section -->
    <section class="search-section">
      <div class="search-container">
        <div class="search-input-container">
          <i class="pi pi-search search-icon"></i>
          <input
            type="text"
            pInputText
            placeholder="Search for sweets..."
            [(ngModel)]="searchQuery"
            (input)="onSearchInputChange()"
            class="search-input"
          />
          <p-button
            *ngIf="searchQuery"
            icon="pi pi-times"
            severity="secondary"
            [text]="true"
            size="small"
            (onClick)="clearSearch()"
            class="clear-search-btn"
          >
          </p-button>
        </div>
      </div>
    </section>

    <!-- Categories Section -->
    <section class="categories-section" *ngIf="categories.length > 0">
      <div class="categories-container">
        <h3 class="categories-title">Categories</h3>
        <div class="categories-list">
          <button
            *ngFor="let category of categories; trackBy: trackByCategoryId"
            class="category-btn"
            [class.active]="selectedCategory?.id === category.id"
            (click)="filterByCategory(category)"
          >
            {{ category.name }}
          </button>
          <button
            class="category-btn"
            [class.active]="!selectedCategory"
            (click)="clearCategoryFilter()"
          >
            All
          </button>
        </div>
      </div>
    </section>

    <!-- Products Section -->
    <section class="products-section">
      <div class="products-header">
        <h2 class="products-title">
          {{
            selectedCategory ? selectedCategory.name + ' Sweets' : 'All Sweets'
          }}
        </h2>
        <span class="products-count">{{ totalItems }} products</span>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <p-progressSpinner
          [style]="{ width: '40px', height: '40px' }"
          strokeWidth="4"
          fill="var(--color-bg-soft)"
          animationDuration="1s"
        >
        </p-progressSpinner>
        <p class="loading-text">Loading sweets...</p>
      </div>

      <!-- Products Grid -->
      <div *ngIf="!isLoading && sweets.length > 0" class="products-grid">
        <div
          *ngFor="let sweet of sweets; trackBy: trackBySweetId"
          class="sweet-card"
        >
          <div class="sweet-image">
            <i class="pi pi-image text-4xl text-neutral-300"></i>
            <div class="sweet-badge" *ngIf="sweet.quantity === 0">
              <span class="badge-text">Out of Stock</span>
            </div>
          </div>

          <div class="sweet-content">
            <h3 class="sweet-name">{{ sweet.name }}</h3>
            <p class="sweet-category" *ngIf="sweet.category">
              {{ sweet.category.name }}
            </p>
            <div class="sweet-price">${{ sweet.price | number: '1.2-2' }}</div>
            <div class="sweet-stock" *ngIf="sweet.quantity > 0">
              <i class="pi pi-box text-sm"></i>
              <span>{{ sweet.quantity }} in stock</span>
            </div>

            <div class="sweet-actions">
              <p-button
                *ngIf="sweet.quantity > 0"
                label="Purchase"
                icon="pi pi-shopping-cart"
                severity="success"
                size="small"
                [disabled]="sweet.quantity === 0"
                (onClick)="onPurchase(sweet)"
                class="purchase-btn"
              >
              </p-button>

              <p-button
                *ngIf="sweet.quantity === 0"
                label="Out of Stock"
                severity="secondary"
                size="small"
                [disabled]="true"
                class="out-of-stock-btn"
              >
              </p-button>
            </div>
          </div>
        </div>
      </div>

      <!-- No Results -->
      <div *ngIf="!isLoading && sweets.length === 0" class="no-results">
        <i class="pi pi-search text-6xl text-neutral-300"></i>
        <h3 class="no-results-title">No sweets found</h3>
        <p class="no-results-message">
          Try adjusting your search or filter criteria.
        </p>
        <p-button
          label="Clear Filters"
          severity="secondary"
          (onClick)="clearAllFilters()"
          class="clear-filters-btn"
        >
        </p-button>
      </div>

      <!-- Pagination -->
      <div *ngIf="!isLoading && sweets.length > 0" class="pagination-container">
        <p-paginator
          [rows]="itemsPerPage"
          [totalRecords]="totalItems"
          [first]="(currentPage - 1) * itemsPerPage"
          (onPageChange)="onPageChange($event)"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Showing {first} to {last} of {totalRecords} products"
          [rowsPerPageOptions]="[12, 24, 48]"
        >
        </p-paginator>
      </div>
    </section>
  </main>
</div>
